#!/usr/bin/env bash

# Use mise to manage tools and environment
use mise

# Create Python virtual environment if it doesn't exist
if [ ! -d ".venv" ]; then
    echo "Creating Python virtual environment..."
    python -m venv .venv
fi

# Activate the virtual environment
source .venv/bin/activate

# Install Python dependencies if requirements.txt exists and packages aren't installed
if [ -f "requirements.txt" ] && [ ! -f ".venv/.deps_installed" ]; then
    echo "Installing Python dependencies..."
    pip install --upgrade pip
    pip install -r requirements.txt
    touch .venv/.deps_installed
fi

# Initialize Hugo submodule if hugo directory exists
if [ -d "hugo" ] && [ ! -f "hugo/themes/hextra/.git" ]; then
    echo "Initializing Hugo submodule..."
    git submodule update --init --recursive
fi

echo "âœ… Silhouette Card Maker environment ready!"
echo ""
echo "ğŸ“ Place your card images in:"
echo "   - Front images: game/front/"
echo "   - Back images: game/back/"
echo "   - Double-sided backs: game/double_sided/"
echo ""
echo "ğŸš€ Quick start:"
echo "   - Create PDF: mise run create-pdf"
echo "   - Riftbound cards: mise run riftbound-workflow"
echo "   - Lorcana cards: mise run lorcana-workflow"
echo "   - See all tasks: mise run help"
echo ""
echo "ğŸ“– Documentation: mise run docs (then visit http://localhost:1313)"